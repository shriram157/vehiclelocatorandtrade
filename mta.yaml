ID: vehicleLocator
_schema-version: '2.1'
description: vehicle Locator MTA
version: 0.0.1

modules:
 - name: vehicleLocator_hdb
   type: hdb
   path: vehicleLocator_hdb
   requires:
    - name: hdi_vehicleLocator_hdb

 - name: vehicleLocator_Node
   type: nodejs
   path: vehicleLocator_Node
   parameters:
      host: vehicleLocator_Node
      register-service-url: true
      service-name: vehicleLocator_Node
      service-url: '${default-url}'
      disk-quota: 256MB
      memory: 256MB
   properties:
      NODE_TLS_REJECT_UNAUTHORIZED: 0
      TRADE_REQ_CLEANUP_TASK_SCH: "0 0 * * *"
   provides:
    - name: vehicleLocator_Node_api
      properties:
         url: ${default-url}
   requires:
    - name: VEHICLE_LOCATOR_APIM_CUPS
    - name: hdi_vehicleLocator_hdb
    - name: uaa_vehicleLocator

 - name: vehicleLocator
   type: html5
   path: vehicleLocator
   parameters:
      host: vehicleLocator
      register-service-url: true
      service-name: vehicleLocator
      service-url: '${default-url}'
      disk-quota: 256M
      memory: 256M
   build-parameters:
      builder: grunt
   requires:
    - name: uaa_vehicleLocator
    - name: dest_vehicleLocator
    - name: vehicleLocator_XSJS_api
      group: destinations
      properties:
        name: vehicleLocator_XSJS_backend
        url: '~{url}'
        forwardAuthToken: true  
    - name: vehicleLocator_Node_api
      group: destinations
      properties:
        name: vehicleLocator_Node_backend
        url: '~{url}'
        forwardAuthToken: true

   provides:
     - name: vehicleLocator    
    

 - name: vehicleLocator_XSJS
   type: nodejs
   path: vehicleLocator_XSJS
   parameters:
      host: vehicleLocator_XSJS
      register-service-url: true
      service-name: vehicleLocator_XSJS
      service-url: '${default-url}'
      disk-quota: 512M
      memory: 256M
   provides:
    - name: vehicleLocator_XSJS_api
      properties:
         url: ${default-url}
   requires:
     - name: vehicleLocator_hdb
     - name: hdi_vehicleLocator_hdb
     - name: uaa_vehicleLocator
     - name: dest_vehicleLocator

resources:
 - name: hdi_vehicleLocator_hdb
   type: com.sap.xs.hdi-container
   parameters:
      config:
         schema: vehicleLocator_hdb
   properties:
      hdi-container-name: ${service-name}
   
 - name: VEHICLE_LOCATOR_APIM_CUPS
   type: org.cloudfoundry.existing-service
   parameters:
     service-name: VEHICLE_LOCATOR_APIM_CUPS
   properties:
      odata-call-service-name: '${service-name}'

 - name: uaa_vehicleLocator
   type: org.cloudfoundry.managed-service
   parameters:
      service: xsuaa
      service-plan: application
      path: ./xs-security.json

 - name: dest_vehicleLocator
   type: org.cloudfoundry.managed-service
   parameters:
      service: destination
      service-plan: lite
